# Nginx configuration for multiplexed persona server
# Each persona gets a unique port, but all requests proxy to single backend

upstream persona_backend {
    server persona-server:9000;
}

# Steve Jobs - Port 9001
server {
    listen 9001;
    server_name localhost;
    
    client_max_body_size 10M;
    
    location / {
        proxy_pass http://persona_backend/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Persona "steve-jobs";
    }
}

# Marcus Aurelius - Port 9002
server {
    listen 9002;
    server_name localhost;
    
    client_max_body_size 10M;
    
    location / {
        proxy_pass http://persona_backend/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Persona "marcus-aurelius";
    }
}

# Shigeru Miyamoto - Port 9003
server {
    listen 9003;
    server_name localhost;
    
    client_max_body_size 10M;
    
    location / {
        proxy_pass http://persona_backend/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Persona "shigeru-miyamoto";
    }
}

# Peter Drucker - Port 9004
server {
    listen 9004;
    server_name localhost;
    
    client_max_body_size 10M;
    
    location / {
        proxy_pass http://persona_backend/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Persona "peter-drucker";
    }
}

# Sun Tzu - Port 9005
server {
    listen 9005;
    server_name localhost;
    
    client_max_body_size 10M;
    
    location / {
        proxy_pass http://persona_backend/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Persona "sun-tzu";
    }
}

# Elon Musk - Port 9006
server {
    listen 9006;
    server_name localhost;
    
    client_max_body_size 10M;
    
    location / {
        proxy_pass http://persona_backend/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Persona "elon-musk";
    }
}