# Nginx configuration for routing to individual persona A2A services
# Each persona runs as a separate container with its own port

# Define upstream servers for each persona
upstream steve_jobs {
    server persona-steve-jobs:9001;
}

upstream marcus_aurelius {
    server persona-marcus-aurelius:9002;
}

upstream elon_musk {
    server persona-elon-musk:9003;
}

upstream peter_drucker {
    server persona-peter-drucker:9004;
}

upstream shigeru_miyamoto {
    server persona-shigeru-miyamoto:9005;
}

upstream sun_tzu {
    server persona-sun-tzu:9006;
}

server {
    listen 80;
    server_name localhost;
    
    # Enable larger request bodies for A2A messages
    client_max_body_size 10M;
    
    # Proxy timeouts for A2A protocol
    proxy_connect_timeout 30s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;
    
    # Common proxy headers
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Host $host;
    proxy_set_header X-Forwarded-Port $server_port;
    
    # A2A Registry health check (direct to registry)
    location /registry/ {
        proxy_pass http://polyhegel-a2a-registry:8080/;
    }
    
    # Steve Jobs - Product Visionary
    location /agents/steve-jobs/ {
        proxy_pass http://steve_jobs/;
    }
    
    # Marcus Aurelius - Stoic Emperor  
    location /agents/marcus-aurelius/ {
        proxy_pass http://marcus_aurelius/;
    }
    
    # Elon Musk - Innovation Leader
    location /agents/elon-musk/ {
        proxy_pass http://elon_musk/;
    }
    
    # Peter Drucker - Management Expert
    location /agents/peter-drucker/ {
        proxy_pass http://peter_drucker/;
    }
    
    # Shigeru Miyamoto - Game Design Master
    location /agents/shigeru-miyamoto/ {
        proxy_pass http://shigeru_miyamoto/;
    }
    
    # Sun Tzu - Strategic Warfare Expert
    location /agents/sun-tzu/ {
        proxy_pass http://sun_tzu/;
    }
    
    # Default route - show available agents
    location / {
        return 200 '<!DOCTYPE html>
<html>
<head>
    <title>Polyhegel A2A Persona Agents</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .agent { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .agent h3 { margin: 0 0 10px 0; color: #333; }
        .agent p { margin: 5px 0; color: #666; }
        .endpoint { font-family: monospace; background: #f5f5f5; padding: 2px 4px; }
    </style>
</head>
<body>
    <h1>🎭 Polyhegel A2A Persona Agents</h1>
    <p>Welcome to the Polyhegel Agent-to-Agent persona system. Each persona is available as an A2A compliant agent:</p>
    
    <div class="agent">
        <h3>💡 Steve Jobs - Product Visionary</h3>
        <p>Expert in product strategy, user experience, and breakthrough innovation</p>
        <p><strong>Endpoint:</strong> <span class="endpoint">/agents/steve-jobs/</span></p>
    </div>
    
    <div class="agent">
        <h3>🏛️ Marcus Aurelius - Stoic Emperor</h3>
        <p>Wisdom on leadership, ethics, and philosophical guidance</p>
        <p><strong>Endpoint:</strong> <span class="endpoint">/agents/marcus-aurelius/</span></p>
    </div>
    
    <div class="agent">
        <h3>🚀 Elon Musk - Innovation Leader</h3>
        <p>Expertise in technology disruption and ambitious ventures</p>
        <p><strong>Endpoint:</strong> <span class="endpoint">/agents/elon-musk/</span></p>
    </div>
    
    <div class="agent">
        <h3>📊 Peter Drucker - Management Expert</h3>
        <p>Management theory, organizational effectiveness, and business strategy</p>
        <p><strong>Endpoint:</strong> <span class="endpoint">/agents/peter-drucker/</span></p>
    </div>
    
    <div class="agent">
        <h3>🎮 Shigeru Miyamoto - Game Design Master</h3>
        <p>Creative game design, user engagement, and innovative entertainment</p>
        <p><strong>Endpoint:</strong> <span class="endpoint">/agents/shigeru-miyamoto/</span></p>
    </div>
    
    <div class="agent">
        <h3>⚔️ Sun Tzu - Strategic Warfare Expert</h3>
        <p>Military strategy, competitive analysis, and tactical planning</p>
        <p><strong>Endpoint:</strong> <span class="endpoint">/agents/sun-tzu/</span></p>
    </div>
    
    <hr>
    <p><strong>A2A Registry:</strong> <span class="endpoint">/registry/</span></p>
    <p><em>All agents are registered with the A2A protocol and support standard A2A interactions.</em></p>
</body>
</html>';
        add_header Content-Type text/html;
    }
}